# V8: リバースエンジニアリングへの耐性に関する要件

## 制御目的

このセクションでは、機密性の高いデータや機能に対して処理・アクセスを行うアプリに対して奨励されるソフトウェア保護の基準をまとめています。ここにまとめている制御が何も無いことが何かの脆弱性につながる訳ではありませんが、これらの制御を講じることで、アプリのリバースエンジニアリングへの耐性を増加させることになり、悪意のある者がアプリの内部を把握したり、アプリからデータを抽出したりするのを難しくすることができます。

ここに記載した制御は、全てのアプリに対し広く適用するようなものではなく、その点ではこれまでのセクションとは違いがあります。むしろこれらの制御は、アプリに対して不正な変更やリバースエンジニアリングが行われることによって発生するリスクを評価した上で、必要に応じて講じるべきものです。

OWASPの「リバースエンジニアリングと非正規なコード変更の技術的リスク」(『Technical Risks of Reverse Engineering and Unauthorized Code Modification』)、「リバースエンジニアリングとコード変更の防止」(『Reverse Engineering and Code Modification Prevention』)」(下記リンク参照)という文書では、データの改ざんとリバースエンジニアリングによって生じる技術的脅威や、関連するビジネスリスクを挙げています。このセクションでは、これらの文書に記述されている技術的脅威を参考にしています。

以下のリストにある各制御は、少なくともMASVS-L1の全てと、V8内の番号が小さいその他項目の制御全てを満たしている場合のみ有効であるといえます。例えば、”解析の防止”のリストにある難読化に関する制御は、”アプリの隔離”と”動的解析と改ざんの防止”、また”端末の結び付け”のリストにある難読化に関する制御とあわせて用いなければ意味がありません。

**留意すべきは、ソフトウェアの保護はセキュリティ制御の代わりとして使用してはいけないということです。MASVR-Rに挙げられている制御は、特定の脅威に対する補足的な保護策をMASVSのセキュリティ要件を満たしたアプリに対して与えることを目的としているものです。**

以下の考慮が適用されます。

1. 脅威のモデルは、攻撃者の目的を明確に定義していなければなりません。さらに、防御対象はその保護手法が提供している保護のレベルに沿って設定されなければなりません。(例えば、リバースエンジニアリングに長けた技術者が最先端のツールと手法を用いた上で、20人日かけてその目的を達成できるレベルの保護、というように）

2. 保護手法は、内容領域専門家が自ら行う耐性検査をもって検証すべきです。(『モバイルセキュリティテスティングガイド』の中の「リバースエンジニアリング("reverse engineering")」と「ソフトウェアの保護に対する評価(assessing software protections)」の章もご参照ください。)

### 動的解析と改ざんの防止

| # | 説明 | R |
| --- | --- | --- |
| **8.1** | 当該アプリは、端末がルート化または脱獄されている場合ユーザーに警告しアプリを終了させることによって検知、及び対応する。 | ✓ |
| **8.2** | 当該アプリはデバッグ行為を防止する、およびまたはデバッグソフトの対象となったことを検知しこれに対応する。その際、全ての利用可能なデバッグプロトコルを網羅していなければならない。 | ✓ |
| **8.3** | 当該アプリはアプリ内のサンドボックスで実行ファイルや重要データが改ざんされたことを検知し、対応する。 | ✓ |
| **8.4** | 当該アプリは、広く使用されているリバースエンジニアリングツール及びフレームワークが端末上に存在することを検知し、これに対応する。 | ✓ |
| **8.5** | 当該アプリは、エミュレータ上で動作していることを検知し、これに対応する。 | ✓ |
| **8.6** | 当該アプリは、自身のメモリ空間のコードやデータが改ざんされていることを検知し、これに対応する。 | ✓ |
| **8.7** | 当該アプリは8.1～8.6それぞれの防御策に関して、複数の機構を実装する。その際、それらの機構が独自の特徴を持ち、またその特徴が多様であるほど脅威への耐性が大きくなることに留意する。 | ✓ |
| **8.8** | 検知メカニズムは、複数の異なるタイプの対応方法を持つ。その中には、一定時間経過後に動作するもの、秘密裏に動作するものを含む。 | ✓ |
| **8.9** | 当該アプリに属する全ての実行ファイルとライブラリはファイルレベルで暗号化する、およびまたは実行ファイル内の重要なコードやデータセグメントは暗号化またはパッケージ化されている。簡単な静的解析では重要なコードやデータが明らかにされない。 | ✓ |
| **8.10** | 難読化はプログラムの防御に適用されるが、これによって動的解析による難読化の解除が防止される。 | ✓ |

### 端末の結び付け

| # | 説明 | R |
| --- | --- | --- |
| **8.11** | 当該アプリは、端末に一意な属性の、その複数から由来するフィンガープリントを使用して端末を特定する機能を実装する。 | ✓ |

### 理解防止

| # | 説明 | R |
| --- | --- | --- |
| **8.12** | 当該アプリに属する全ての実行ファイルとライブラリはファイルレベルで暗号化する、およびまたは実行ファイル内の重要なコードやデータセグメントは暗号化またはパッケージ化されている。簡単な静的解析では重要なコードやデータが明らかにされない。 | ✓ |
| **8.13** | 現時点で発表されている調査から見るに、難読化の目的が機密度の高い処理を保護するためである場合、難読化の手法は、現在の作業に適していることと、手動または自動化された難読化解除の手法に対して堅牢であるものが使用される。難読化手法の有効性は、手動の検査を通じて検証されなければならない。ハードウェアベースでの隔離策が可能な場合は、その方が難読化よりも好ましいことに留意する。 | ✓ |

## 検証方法

OWASPのモバイルセキュリティ検証ガイドは、このセクションで挙げた要件について検証するための詳細な方法を提示しています。

- Android - https://github.com/OWASP/owasp-mstg/blob/master/Document/0x05j-Testing-Resiliency-Against-Reverse-Engineering.md
- iOS - https://github.com/OWASP/owasp-mstg/blob/master/Document/0x06j-Testing-Resiliency-Against-Reverse-Engineering.md

## 参考文献

- OWASP Mobile Top 10: M8 - Code Tampering(コード改ざん), M9 - Reverse Engineering(リバースエンジニアリング)
- WASP Reverse Engineering Threats -https://www.owasp.org/index.php/Technical_Risks_of_Reverse_Engineering_and_Unauthorized_Code_Modification
- OWASP Reverse Engineering and Code Modification Prevention - https://www.owasp.org/index.php/OWASP_Reverse_Engineering_and_Code_Modification_Prevention_Project
 